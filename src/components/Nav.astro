---
// src/components/Nav.astro

const links = [
  { href: '/',         label: 'Home' },
  { href: '/projects', label: 'Projects' },
  { href: '/blog',     label: 'Blog' },
  { href: '/about',    label: 'About' },
];

// è¯†åˆ«å½“å‰è·¯å¾„ä¸å½“å‰è¯­è¨€
const path = Astro.url.pathname || '/';
const SUPPORTED = new Set(['fi', 'sv', 'zh', 'yue']);

const firstSeg = path.split('/')[1] || '';
const currentLang = SUPPORTED.has(firstSeg) ? firstSeg : 'en';

// æ ¹æ®å½“å‰è¯­è¨€ï¼Œä¸ºç«™å†…é“¾æ¥è‡ªåŠ¨åŠ å‰ç¼€
const withLang = (p: string) =>
  currentLang === 'en' ? p : `/${currentLang}${p}`;

// é«˜äº®å½“å‰å¯¼èˆª
const isActive = (href: string) => {
  const full = withLang(href);
  return full === path || (full !== '/' && path.startsWith(full));
};

// è¯­è¨€åˆ‡æ¢æ—¶ï¼Œä¿ç•™å½“å‰é¡µé¢è·¯å¾„ï¼Œåªæ›¿æ¢è¯­è¨€å‰ç¼€
const switchTo = (code: string) => {
  if (code === currentLang) return path;
  if (code === 'en') {
    // å»æ‰ç°æœ‰çš„è¯­è¨€å‰ç¼€
    return SUPPORTED.has(firstSeg) ? path.replace(/^\/(fi|sv|zh|yue)(?=\/|$)/, '') || '/' : path;
  }
  // å…¶å®ƒè¯­è¨€ï¼šå¦‚æœå½“å‰æ˜¯ ENï¼ŒåŠ ä¸Šå‰ç¼€ï¼›å¦åˆ™æ›¿æ¢å‰ç¼€
  if (currentLang === 'en') return `/${code}${path === '/' ? '' : path}`;
  return path.replace(/^\/(fi|sv|zh|yue)(?=\/|$)/, `/${code}`);
};

const langShort = (code: string) =>
  code === 'en' ? 'EN' : code === 'fi' ? 'FI' : code === 'sv' ? 'SV' : code === 'zh' ? 'ä¸­æ–‡' : 'ç²µèª';
---

<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-zinc-200 dark:bg-zinc-900/80 dark:border-zinc-800">
  <div class="mx-auto max-w-7xl h-16 px-4 md:px-8 flex items-center gap-4">
    <!-- å“ç‰Œ -->
    <a href={withLang('/')} class="shrink-0 font-extrabold tracking-tight text-[20px] md:text-[22px]">
      Xiaosi Huang
    </a>

    <!-- åˆ†éš”çº¿ -->
    <div class="hidden sm:block h-5 w-px bg-zinc-200 dark:bg-zinc-800"></div>

    <!-- ä¸»å¯¼èˆªï¼ˆæ¡Œé¢ï¼‰ -->
    <nav class="hidden sm:flex items-center gap-2 text-[15px] md:text-[16px] font-medium">
      {links.map((l) => (
        <a
          href={withLang(l.href)}
          aria-current={isActive(l.href) ? 'page' : undefined}
          class={
            (isActive(l.href)
              ? 'text-zinc-900 dark:text-zinc-100 bg-zinc-100/80 dark:bg-zinc-800'
              : 'text-zinc-600 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-white hover:bg-zinc-100/60 dark:hover:bg-zinc-800/70'
            ) + ' px-3 py-1.5 rounded-lg transition'
          }
        >
          {l.label}
        </a>
      ))}
    </nav>

    <!-- å³ä¾§å ä½ï¼ŒæŠŠè¯­è¨€æ¨åˆ°æœ€å³ -->
    <div class="ml-auto"></div>

    <!-- è¯­è¨€ï¼šæ¡Œé¢ä¸‹æ‹‰ -->
    <details class="relative hidden sm:block">
      <summary class="list-none cursor-pointer select-none rounded-md border border-zinc-300/70 dark:border-zinc-700 px-2 py-1.5 text-[14px] flex items-center gap-1">
        ğŸŒ {langShort(currentLang)}
      </summary>
      <ul class="absolute right-0 mt-2 w-44 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 shadow-lg p-2 space-y-1 z-50">
        <li><a href={switchTo('en')}  class="block rounded-md px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¬ğŸ‡§ English</a></li>
        <li><a href={switchTo('fi')}  class="block rounded-md px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡«ğŸ‡® Suomi</a></li>
        <li><a href={switchTo('sv')}  class="block rounded-md px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¸ğŸ‡ª Svenska</a></li>
        <li><a href={switchTo('zh')}  class="block rounded-md px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</a></li>
        <li><a href={switchTo('yue')} class="block rounded-md px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡­ğŸ‡° Cantonese</a></li>
      </ul>
    </details>

    <!-- ç§»åŠ¨ç«¯ï¼šåˆå¹¶èœå•+è¯­è¨€ -->
    <details class="relative sm:hidden">
      <summary class="list-none cursor-pointer select-none rounded-md border border-zinc-300/70 dark:border-zinc-700 px-2 py-1.5 text-[14px]">
        Menu
      </summary>
      <div class="absolute right-0 mt-2 w-56 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 shadow-lg p-2 z-50">
        <div class="px-2 pb-2 text-[12px] uppercase tracking-wide opacity-60">Navigate</div>
        <nav class="flex flex-col gap-1 mb-2">
          {links.map((l) => (
            <a
              href={withLang(l.href)}
              class={(isActive(l.href)
                ? 'bg-zinc-100/80 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100'
                : 'hover:bg-zinc-100/60 dark:hover:bg-zinc-800/70 text-zinc-700 dark:text-zinc-300')
                + ' rounded-md px-3 py-2'}
            >
              {l.label}
            </a>
          ))}
        </nav>

        <div class="px-2 pt-1 pb-2 text-[12px] uppercase tracking-wide opacity-60">Language</div>
        <ul class="space-y-1">
          <li><a href={switchTo('en')}  class="block rounded-md px-3 py-2 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¬ğŸ‡§ English</a></li>
          <li><a href={switchTo('fi')}  class="block rounded-md px-3 py-2 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡«ğŸ‡® Suomi</a></li>
          <li><a href={switchTo('sv')}  class="block rounded-md px-3 py-2 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¸ğŸ‡ª Svenska</a></li>
          <li><a href={switchTo('zh')}  class="block rounded-md px-3 py-2 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</a></li>
          <li><a href={switchTo('yue')} class="block rounded-md px-3 py-2 hover:bg-zinc-100 dark:hover:bg-zinc-800">ğŸ‡­ğŸ‡° Cantonese</a></li>
        </ul>
      </div>
    </details>
  </div>
</header>
