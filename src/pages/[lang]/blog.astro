---
import Layout from "../../layouts/Layout.astro";
import { dict, normalizeLang, languages } from "../../i18n";
import { getCollection } from "astro:content";

export const prerender = true;
export function getStaticPaths() {
  return languages.map((lang) => ({ params: { lang } }));
}

const lang = normalizeLang(Astro.params.lang as string);
const t = dict[lang];

// 只取当前语言
const posts = (await getCollection("blog", ({ data }) => !data.draft && data.lang === lang))
  .sort((a, b) => (a.data.date < b.data.date ? 1 : -1));

const base = lang === "en" ? "/en" : `/${lang}`;
---

<Layout lang={lang} title={`Xiaosi Huang · ${t.nav.blog}`}>
  <section class="mx-auto max-w-3xl px-4 md:px-0 py-12">
    <h1 class="text-3xl font-bold mb-2">{t.blog.title}</h1>
    <p class="opacity-70 mb-8">{t.blog.subtitle}</p>

    {posts.length === 0 ? (
      <p class="opacity-60">No posts yet.</p>
    ) : (
      <div class="space-y-4">
        {posts.map((p) => (
          <a href={`${base}/blog/${p.data.slug ?? p.slug}`}
             class="block rounded-2xl border border-zinc-200 dark:border-zinc-800 p-5 hover:bg-zinc-50 dark:hover:bg-zinc-800/40">
            <h2 class="text-xl font-semibold mb-1">{p.data.title}</h2>
            <div class="opacity-60 text-sm mb-1">{p.data.date}</div>
            {p.data.summary && <p class="opacity-80">{p.data.summary}</p>}
          </a>
        ))}
      </div>
    )}
  </section>
</Layout>
