---
title: "用多元高斯分佈做異常偵測：共享單車需求個案研究"
date: "2025-09-01"
excerpt: "透過簡單嘅高斯模型，識別共享單車需求數據中唔尋常嘅情況。"
tags: ["機器學習", "databricks", "異常偵測", "高斯分佈"]
draft: false
---

## 1️⃣ 引言

呢個project主要想驗證一個直覺：**係咪用一個好簡單嘅統計模型，都已經可以喺真實數據度發現有意思嘅模式？** 我揀咗 Databricks 提供嘅 **共享單車數據集**，因為佢同時包含 **天氣資訊** 同 **每小時嘅租賃數量**，啱晒去問呢條問題：

👉 *「共享單車嘅需求，係咪真係同天氣狀況相匹配？」*  

我冇急住上複雜嘅機器學習，而係由 **多元高斯分佈** 入手。呢個方法乾淨、透明，容易解釋「正常」應該係點樣。

---

## 2️⃣ 技術設定

用嘅數據喺呢度：`dbfs:/databricks-datasets/bikeSharing/data-001/hour.csv`

數據集有 **17,379 條逐小時記錄**，重點特徵包括溫度（`temp`）、濕度（`hum`）同單車租賃數（`cnt`）。我集中用呢三個，因為佢哋都係 **連續變量**，而且 **直覺上互相關聯**：如果天氣差（例如凍又濕），租賃數通常都會落。  

模型思路其實好直白：
- 1. 計 **均值向量 μ** 同 **協方差矩陣 Σ**；  
- 2. 用 **多元高斯 PDF** 幫每一行數據打分；  
- 3. 如果某行嘅概率 **低過第 5 個百分位數**，就標記為異常。  

即係話，「正常需求」係由「天氣 + 租賃數」嘅**聯合分佈**定義；任何出現機率太低嘅情況，都會俾模型捉到。

---

## 3️⃣ 工作流程

### 數據探索（Exploration）  
我先瀏覽咗資料夾，確定攞嘅檔案冇錯；之後快手畫咗溫度、濕度同租賃數嘅分佈圖，先有個範圍上嘅感覺。

### 模型擬合（Model fitting）  
計 μ 同 Σ 嘅時候，我留意到有啲特徵之間 **關聯幾強**（例如濕度同需求）。用協方差矩陣就啱啱好，可以將呢啲相關性納入計算。

### 閾值設定（Thresholding）  
我揀咗 **第 5% 分位**做cutoff。講法好簡單：**「如果喺正常情況底下，某件事發生機率唔夠 5%，我哋就當佢係異常。」**

### 視覺化驗證（Visualization）  
為咗確認標記係咪合理，我畫咗 `temp` 對 `cnt` 嘅散點圖，用**橙色「x」**去highlight異常點。最明顯有兩類：
- **天氣差（凍／落雨）但租賃數反而好高**；  
- **天氣好，但租賃數反而好低**。  

呢啲都幾貼近直覺，證明個方法真係捉到啱嘅異常類型。

---

## 4️⃣ Databricks 工作畫面

<div class="screenshot-large">
  <img src="/images/projects/project2/1.png" alt="Databricks notebook 全頁截圖">
</div>

---

## 5️⃣ 反思同總結

做完呢個project，我更加肯定：**好多時候，簡單嘅統計工具已經好夠用**。多元高斯分佈概念上唔複雜，但喺「找出唔匹配天氣嘅需求模式」呢件事上，表現出奇地唔錯。  

我特別深刻嘅係 **特徵之間嘅相關性**。溫度、濕度、需求唔係互相獨立，放埋一齊建模，其實係學緊「正常情況嘅形狀」。好似：**濕度好高但租賃數都好高** 呢啲罕見組合，模型就會覺得唔尋常而標記出嚟。呢度再次體會到 **協方差結構**喺異常偵測入面幾關鍵——單變量方法係會miss晒呢啲情況。  

**閾值點揀**都幾考慮。今次我用 **5%**，對呢個數據嚟講幾平衡：又捉到唔尋常時段，又唔會over-flag正常波動。不過如果落到生產，呢個cutoff就要同持份者傾：運維可能想**少啲誤報**，產品可能寧願**多啲抓到異常**。背後其實就係 **統計嚴謹 vs 業務可用** 嘅trade-off。  

以數據工程角度，我更加重視 **可解釋同可重現**。高斯baseline喺 Databricks implement 快、易維護，仲可以用一張圖同非技術同事講清楚。相比黑盒深度學習，**溝通成本同運維成本都低**，尤其適合同步做**每日監控job**，自動標出異常。  

總結嚟講，異常偵測未必要靠複雜模型先有價值。有時 **簡單、可解釋嘅統計方法** 反而係最好嘅起點：**快見效、易落地，又可以作為穩陣baseline**，之後再疊加更進階嘅方法。
