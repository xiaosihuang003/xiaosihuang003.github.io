---
title: "多元高斯分布下的异常检测：共享单车需求案例研究"
date: "2025-09-01"
excerpt: "探索如何利用高斯建模来发现共享单车需求中的异常模式。"
tags: ["机器学习", "databricks", "异常检测", "高斯分布"]
draft: false
---

## 1️⃣ 引言

在这个项目里，我想验证一个想法：**是不是用一个很简单的统计模型，就能在真实数据里发现有趣的模式？** 我选择了 Databricks 提供的 **共享单车数据集**，因为它同时包含了 **天气信息** 和 **每小时的租赁数量**，非常适合我想问的这个问题：  

👉 *“共享单车的需求是否真的和天气状况相匹配？”*  

我没有急着用复杂的机器学习算法，而是决定从 **多元高斯分布** 出发。它可以干净利落地刻画“正常情况”是什么样子，而且非常容易解释。  

---

## 2️⃣ 技术准备

我用到的数据集存放在：dbfs:/databricks-datasets/bikeSharing/data-001/hour.csv  

它包含 **17,379 条按小时记录**，里面的特征包括温度（`temp`）、湿度（`hum`）和单车租赁数量（`cnt`）。我专门选了这三个特征，因为它们都是 **连续变量**，并且 **直观上彼此相关**：如果天气很差（比如温度低、湿度高），租赁数量应该也会下降。  

模型思路其实很简单：
- 1. 计算特征的 **均值向量 μ** 和 **协方差矩阵 Σ**；  
- 2. 用 **多元高斯 PDF** 给每一行数据打分；  
- 3. 如果某行的概率 **低于第 5 个百分位数**，就标记为异常。  

换句话说，“正常需求”由天气 + 租赁数量的联合分布来定义，任何出现概率太低的情况就会被识别出来。  

---

## 3️⃣ 工作流程

1. **数据探索**  
   我先浏览了文件夹，确认选对了数据文件。之后快速画了温度、湿度和租赁数的分布图，对数据范围有了一个直观认识。  

2. **模型训练**  
   计算均值向量和协方差矩阵时，我发现一些特征之间确实存在很强的相关性（比如湿度和需求量）。而协方差矩阵正好能捕捉这种依赖关系。  

3. **阈值设定**  
   我把阈值设在 **第 5 个百分位**。这样解释起来也很直观：“如果某种情况在正常条件下出现的概率不到 5%，那就算作异常。”  

4. **可视化验证**  
   为了确认标记的点合理，我画了 `temp` 对 `cnt` 的散点图，并用橙色的 “x” 标出异常点。  
   最明显的发现有两类：  
   - **天气很差（冷+雨）但租赁数量异常高的时段**；  
   - **天气很好但租赁数量异常低的时段**。  

这些情况和直觉完全一致，说明方法确实捕捉到了正确的异常。  

---

## 4️⃣ Databricks 工作区

<div class="screenshot-large">
  <img src="/images/projects/project2/1.png" alt="Databricks notebook 全页截图">
</div>

---

## 5️⃣ 反思与总结

做这个项目让我更清楚地认识到：其实很多时候，**简单的统计工具已经足够强大**。虽然多元高斯分布在概念上并不复杂，但它意外地有效，能直接找出那些“和天气不符”的需求模式。  

我最先注意到的是 **特征之间的相关性**。温度、湿度和需求量并不是孤立的变量，把它们放在一起建模，能学到“正常条件下的形状”。比如，当湿度很高但租赁数量依然很高时，模型就会觉得这是稀有组合并把它标出来。这让我意识到，**协方差结构**在异常检测中非常关键，而单变量的方法完全捕捉不到这些情况。  

阈值的选择也是一个值得思考的点。我把它定在 **5%**，对这个数据来说很合适：既能捕捉不寻常的时段，又不会把正常波动都算进去。但如果放在生产环境中，这个阈值就不能我一个人说了算，而是要和不同团队沟通。运维团队可能更在意少报错（减少误报），而产品团队可能更倾向多捕捉异常。这背后其实就是一个 **统计严谨性 vs 业务可用性** 的权衡。  

从数据工程的角度，我还体会到 **可解释性和可复现性的重要性**。高斯模型不仅能快速在 Databricks 上实现，而且输出的结果可以一张图就让非技术人员理解。相比起黑箱的深度学习，这样的模型更容易沟通、也更适合部署成一个日常任务，每天自动标出异常。  

总的来说，这个项目让我认识到：异常检测并不总是要依赖复杂模型才能产生价值。有时候，**一个简单、可解释的统计方法就是最好的起点**，既能快速得到洞察，也能作为基线方法，为后续更复杂的技术打好基础。
